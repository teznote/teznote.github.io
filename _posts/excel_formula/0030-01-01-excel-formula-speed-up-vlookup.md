---
layout: post
title: "VLOOKUP: 유사일치 방식으로 VLOOKUP 속도 높이기"
updated: 2023-05-08
tags: [excel_formula]
---

아래는 보통 사용하는 VLOOKUP 함수식이다.

```excel
= VLOOKUP( 검색값, 검색범위, 열번호, false )
```
{:.excel}

네번째 인수에는 보통 false 값을 적용하여 "정확한일치검색"을 주로 사용한다.

하지만 검색대상 데이터가 굉장히 많으면서, VLOOKUP 함수를 사용한 셀도 굉장히 많다면, 눈에 띄게 계산 속도가 떨어지게 되는데, 누구나 한번쯤은 이로인해 답답함을 겪어봤을 것이다.

한편 VLOOKUP 네번째 인수에 true 값을 적용하여 "유사일치검색"을 사용할 수도 있는데, 이는 정확한일치 값을 찾지는 않지만 속도가 매우 빠르다. 이를 응용하면 "정확한일치검색"과 동일한 결과를 가져오면서도 획기적인 속도개선이 가능하다.

## 유사일치검색 방식으로 속도 개선

![그림00](/img/excel_formula/formula-0030-00.png)

```excel
= IF( VLOOKUP( 검색값, 검색범위, 1, true ) = 검색값, VLOOKUP( 검색값, 검색범위, 열번호, true ), NA() )
```
{:.excel}

VLOOKUP 함수를 두번 사용하였다. "유사일치검색"은 `검색값`이 없더라도 유사한 값을 결과값으로 내놓기 때문에 찾은 값이 `검색값`과 같으면 다시 그 값을, 아니라면 NA 에러를 발생하도록 되어있다.

하지만 사용함에 있어 반드시 아래 사항은 주의해야 한다.

- `검색범위`의 가장 왼쪽열은 반드시 오름차순으로 정렬되어 있어야 한다.
- 만일 원본 데이터 목록을 손봤다면(예를들어 레코드 삽입) 다시금 오름차순으로 정렬을 해줘야 한다. 
{:.warning}

"유사일치검색" 속도가 빠른 이유는 [이진탐색](https://namu.wiki/w/%EC%9D%B4%EC%A7%84%20%ED%83%90%EC%83%89) 알고리즘을 사용하는 검색이기 때문이다. 원리는 링크 또는 아래 내용을 참고하면 된다.

- 오름차순으로 정렬되어 있는 데이터 목록에서 어떤 값 X 을 찾는다고 한다면, X 와 데이터 중간값 Y 를 비교하여, X < Y 라면 Y 보다 앞부분에 해당하는 데이터만을 추려서 다시 중간값과 X 를 비교하고, X > Y 라면 Y 보다 뒷부분에 해당하는 데이터만을 추려서 다시 중간값과 X 를 비교한다.
- 비교 후 필요한 부분만 추리고, 더이상 비교할 필요가 없는 부분을 버려버리는 방식이기 때문에 데이터가 오름차순으로 정렬되어있지 않으면 제대로 된 결과 도출이 어려워질 수 있다.
{:.note}

예를들어 원본 데이터가 10,000 개가 있다고 한다면 "정확한일치검색" 방식으로는 최악의 경우 10,000 번 검색을 수행해야한다. 그러나 "유사일치검색" 방식으로는 최대 15 번만 수행하면 된다.