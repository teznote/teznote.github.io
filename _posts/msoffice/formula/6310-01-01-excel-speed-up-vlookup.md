---
layout: post
title: "VLOOKUP: 유사일치 방식으로 VLOOKUP 함수 속도 높이기"
updated: 2021-05-03
categories: [excel_formula]
tags: [excel,formula,vlookup,if,na]
---

## VLOOKUP 속도 개선

엑셀에서 VLOOKUP 함수를 사용할 땐, 보통 네번째 인수에 FALSE 값을 적용하여 "정확한일치검색"을 주로 사용한다. 하지만 검색대상 데이터가 굉장히 많으면서, VLOOKUP 함수를 사용한 셀도 굉장히 많다면, 눈에 띄게 계산 속도가 떨어지게 되는데, 누구나 한번쯤은 이 때문에 답답함을 겪어봤을 것이다.

한편 VLOOKUP 네번째 인수에 TRUE 값을 적용하여 "유사일치검색"을 사용할 수도 있는데, 이는 정확한일치 값을 찾지는 않지만 속도가 매우 빠르다. 이를 응용하면 획기적인 속도개선이 가능하다.

![그림00](/img/msoffice/formula/formula-6310.png)

```excel
= IF( VLOOKUP( 검색값, 검색범위, 1, TRUE ) = 검색값, VLOOKUP( 검색값, 검색범위, 열번호, TRUE ), NA() )
```
{:.excel}

VLOOKUP 함수를 두번 사용하였다. 유사일치로 찾은 값이 검색값과 같으면 다시 그 값을, 아니라면 NA 에러를 발생하도록 했다. 따라서 "정확한일치검색"과 동일하게 작동하면서도 월등한 속도 개선을 꾀할 수 있다.

다만, 위 함수식을 적용하려면 검색기준이 되는 **`검색범위`의 가장 왼쪽열은 반드시 오름차순으로 정렬이 되어있어야 한다.** 그렇지 않으면 정확한 검색이 이뤄지지 않는다.

## 함수식 이해

"유사일치검색" 방식 속도가 빠른이유는 작동 방식의 차이 때문이다. "유사일치검색" 은 검색범위 가장 왼쪽열의 가운데 항목값과 검색값을 먼저 비교한다. 가운데 항목값 > 검색값 이라면 가운데 항목값보다 아래에 있는 항목들을 버려버린다. 왜냐하면 오름차순으로 정렬이 되어 있기 때문에 검색값은 가운데 항목값보다 위쪽에 위치할 것이기 때문이다.

버리고 난 뒤 남은 항목들의 다시 가운데 항목값과 검색값을 다시 비교한다. 그리고 위 또는 아래를 버려버린다. 이런 방식으로 동작한다. 따라서 오름차순으로 정렬되어 있지 않으면 오동작 할 수밖에 없다.

프로그래밍에서는 이를 이진탐색 알고리즘이라 한다. [별도 포스팅](/post/leetcode-binary-search)을 참고해보자.

만일 함수식을 사용한 다음에 원본 데이터를 수정했다면, 다시금 오름차순을 적용하는 걸 잊지 말아야 한다.