---
layout: post
title: "VLOOKUP: 유사일치 방식으로 VLOOKUP 속도 높이기"
updated: 2023-05-08
tags: [msoffice,formula]
---

## VLOOKUP 속도 개선

엑셀에서 VLOOKUP 을 사용할 땐, 보통 네번째 인수에 false 값을 적용하여 "정확한일치검색"을 주로 사용한다. 하지만 검색대상 데이터가 굉장히 많으면서, VLOOKUP 함수를 사용한 셀도 굉장히 많다면, 눈에 띄게 계산 속도가 떨어지게 되는데, 누구나 한번쯤은 이로인해 답답함을 겪어봤을 것이다.

한편 VLOOKUP 네번째 인수에 true 값을 적용하여 "유사일치검색"을 사용할 수도 있는데, 이는 정확한일치 값을 찾지는 않지만 속도가 매우 빠르다. 이를 응용하면 획기적인 속도개선이 가능하다.

![그림00](/img/msoffice/formula/formula-6310.png)

```excel
= IF( VLOOKUP( 검색값, 검색범위, 1, true ) = 검색값, VLOOKUP( 검색값, 검색범위, 열번호, true ), NA() )
```
{:.excel}

VLOOKUP 함수를 두번 사용하였다. 유사일치는 `검색값`이 없더라도 유사한 값을 결과값으로 내놓기 때문에 유사일치로 찾은 값이 `검색값`과 같으면 다시 그 값을, 아니라면 NA 에러를 발생하도록 되어있다. 따라서 "정확한일치검색"과 동일하게 작동하면서도 월등한 속도 개선을 꾀할 수 있다.

하지만 사용함에 있어 반드시 아래 사항은 주의해야 한다.

`검색범위`의 가장 왼쪽열은 반드시 오름차순으로 정렬되어 있어야 한다.
{:.warning}

오름차순이 아니라면 정확한 검색이 이뤄지지 않는다. (그 이유는 아래 함수식 이해에 별도로 설명했다.) 만일 함수식을 사용한 다음 원본 데이터를 손봤다면 **반드시 오름차순으로 정렬**하는 것을 잊어서는 안된다.

## 함수식 이해

"유사일치검색" 방식 속도가 빠른이유는 작동 방식의 차이 때문이다. "유사일치검색" 은 검색범위 가장 왼쪽열의 가운데 항목값과 검색값을 먼저 비교한다. 가운데 항목값 > 검색값 이라면 가운데 항목값보다 아래에 있는 항목들을 버려버린다. 왜냐하면 오름차순으로 정렬이 되어 있기 때문에 검색값은 가운데 항목값보다 위쪽에 위치할 것이기 때문이다.

버리고 난 뒤 남은 항목들의 다시 가운데 항목값과 검색값을 다시 비교한다. 그리고 위 또는 아래를 버려버린다. 이런 방식으로 동작한다. 따라서 오름차순으로 정렬되어 있지 않으면 오동작 할 수밖에 없다.

예를들어 원본 데이터가 10,000 개가 있다고 한다면 "정확한일치검색" 방식으로는 최악의 경우 10,000 번 검색을 수행한다. 그러나 "유사일치검색" 방식으로는 많아야 15 번만 검색하면 된다. 프로그래밍에서는 이를 이진탐색 알고리즘이라 하는데, 관심있다면 [별도 포스팅(TBD)](#)을 참고하자.